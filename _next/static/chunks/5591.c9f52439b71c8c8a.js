"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5591],{5591:function(n,t,e){e.r(t),e.d(t,{default:function(){return l}});var i=e(15861),r=e(97685),o=e(67294),s=e(63596),a=e(23044),c=e(16881),u=e(85893),d=function(){var n=(0,o.useState)(),t=(0,r.Z)(n,2),e=t[0],i=t[1];return(0,o.useEffect)(function(){i(window.aptos||new s.Of({}))},[]),e};function l(){var n,t,e,s,l,h=d(),g=(0,o.useState)(""),v=(0,r.Z)(g,2),p=v[0],f=v[1],m=(0,o.useState)(!1),_=(0,r.Z)(m,2),y=_[0],w=_[1],b=(0,o.useState)(null),C=(0,r.Z)(b,2),T=C[0],S=C[1];if((0,o.useEffect)(function(){if(h)return h.on("connect",function(n){w(!0),S(n),console.log("aptos.on [connect] "+n)}),h.on("disconnect",function(){S(null),w(!1),console.log("aptos.on [disconnect] \uD83D\uDC4B")}),h.on("networkChange",function(n){f(n),console.log("aptos.on [networkChange] "+n)}),h.on("accountChanged",function(n){S(n),w(!!n),console.log("aptos.on [accountChange] "+n)}),h.onNetworkChange(function(n){f(n),console.log("aptos [onNetworkChange] "+n)}),h.onAccountChange(function(n){S(n),n?(w(!0),console.log("aptos [onAccountChange] Switched account to "+n)):(console.log("aptos [onAccountChange] Switched unknown account"),h.connect().then(function(){return console.log("[accountChanged] Reconnected successfully")}).catch(function(n){console.log("[accountChanged] Failed to re-connect: "+n.message)}))}),function(){h.disconnect()}},[h]),!h)return(0,u.jsx)("h2",{children:"Could not find a provider"});var k=(n=(0,i.Z)(function*(){try{var n=yield h.connect(),t=yield h.network();S(n.address),f(t),w(!0),console.log("[connectWallet] account",n,t)}catch(n){console.warn(n),console.log("[error] connect: "+JSON.stringify(n))}}),function(){return n.apply(this,arguments)}),x=(t=(0,i.Z)(function*(){try{yield h.disconnect()}catch(n){console.warn(n),console.log("[error] disconnect: "+JSON.stringify(n))}}),function(){return t.apply(this,arguments)}),A=(e=(0,i.Z)(function*(){console.log("[signTransaction]",(yield h.signAndSubmitTransaction({arguments:[T,"100000"],function:"0x1::coin::transfer",type:"entry_function_payload",type_arguments:["0x1::aptos_coin::AptosCoin"]})))}),function(){return e.apply(this,arguments)}),j=(s=(0,i.Z)(function*(){console.log("[signTransaction]",(yield h.signTransaction({arguments:[T,"100000"],function:"0x1::coin::transfer",type:"entry_function_payload",type_arguments:["0x1::aptos_coin::AptosCoin"]})))}),function(){return s.apply(this,arguments)}),B=(l=(0,i.Z)(function*(){console.log("[signMessage]",(yield h.signMessage({address:!1,application:!0,chainId:!0,message:"This is a sample message",nonce:12345})))}),function(){return l.apply(this,arguments)});return(0,u.jsxs)("div",{children:[(0,u.jsx)(a.p,{dapps:c.F}),!h&&(0,u.jsx)("a",{target:"_blank",href:"https://www.onekey.so/download/",children:"Install OneKey Extension →"}),(0,u.jsx)("main",{children:h&&y?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{children:[(0,u.jsxs)("pre",{children:["Network: ",p]}),(0,u.jsxs)("pre",{children:["Connected as: ",T]})]}),(0,u.jsx)("button",{onClick:A,children:"Sign&Send Transaction"}),(0,u.jsx)("button",{onClick:j,children:"Sign Transaction "}),(0,u.jsx)("button",{onClick:B,children:"Sign Message"}),(0,u.jsx)("button",{onClick:function(){return x()},children:"Disconnect"})]}):(0,u.jsx)(u.Fragment,{children:(0,u.jsx)("button",{onClick:function(){return k()},children:"Connect Wallet"})})})]})}},16881:function(n,t,e){e.d(t,{F:function(){return i}});var i=[{name:"SEAM",url:"https://app.seam.money/"},{name:"Aptos Names",url:"https://www.aptosnames.com/"},{name:"Liquid Swap",url:"https://liquidswap.com/#/"}]},23044:function(n,t,e){e.d(t,{p:function(){return s}}),e(67294);var i=e(99034),r=e.n(i),o=e(85893);function s(n){var t=n.dapps;return(0,o.jsxs)("div",{className:r().container,children:[(0,o.jsx)("h3",{children:"Top DApps"}),(0,o.jsx)("ul",{children:t.map(function(n){return(0,o.jsx)("li",{children:(0,o.jsxs)("a",{href:n.url,target:"_blank",children:[n.name," ↗"]})},n.name)})})]})}},22519:function(n,t,e){e.d(t,{R:function(){return s}});var i=e(57069);let{JS_BRIDGE_MESSAGE_DIRECTION:r,JS_BRIDGE_MESSAGE_EXT_CHANNEL:o}=i.vH;function s(n={}){let t=()=>new c(Object.assign(Object.assign({},n),{receiveHandler:i.gZ})),e=(0,i.Pk)(t);return e}let a=!1;class c extends i.ZN{constructor(n){super(n),this.sendAsString=!1,this.isInjected=!0,function(n={}){let t=n.debugLogger||i.go;a||(a=!0,window.addEventListener("message",e=>{var i,s;if(e.source!==window)return;let a=e.data;if(a.channel===o&&a.direction===r.HOST_TO_INPAGE){t.extInjected("onWindowPostMessage",a);let e=a.payload,r=null!==(i=n.bridge)&&void 0!==i?i:null===(s=null==window?void 0:window.$onekey)||void 0===s?void 0:s.jsBridge;r&&r.receive(e)}},!1))}({debugLogger:this.debugLogger,bridge:this})}sendPayload(n){window.postMessage({channel:o,direction:r.INPAGE_TO_HOST,payload:n})}}},63596:function(n,t,e){e.d(t,{Of:function(){return h},GR:function(){return p}});var i=e(22519),r=e(10366),o=e(57069);class s extends o.BX{constructor(n){super(n),this.providerName=r.U.aptos}request(n){return this.bridgeRequest(n)}}var a=e(14859),c=e(48764).Buffer,u=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(n){try{c(i.next(n))}catch(n){o(n)}}function a(n){try{c(i.throw(n))}catch(n){o(n)}}function c(n){var t;n.done?r(n.value):((t=n.value)instanceof e?t:new e(function(n){n(t)})).then(s,a)}c((i=i.apply(n,t||[])).next())})};let d={connect:"connect",disconnect:"disconnect",accountChanged:"accountChanged",networkChange:"networkChange",message_low_level:"message_low_level"};function l({method:n,name:t}){return n===`wallet_events_${t}`}class h extends s{constructor(n){super(Object.assign(Object.assign({},n),{bridge:n.bridge||(0,i.R)({timeout:n.timeout})})),this._account=null,this.aptosProviderType="petra",this._registerEvents()}get publicKey(){var n,t;return null!==(t=null===(n=this._account)||void 0===n?void 0:n.publicKey)&&void 0!==t?t:null}_registerEvents(){window.addEventListener("onekey_bridge_disconnect",()=>{this._handleDisconnected()}),this.on(d.message_low_level,n=>{if(!n)return;let{method:t,params:e}=n;l({method:t,name:d.accountChanged})&&this._handleAccountChange(e),l({method:t,name:d.networkChange})&&this._handleNetworkChange(e)})}_callBridge(n){return n.aptosProviderType=this.aptosProviderType,this.bridgeRequest(n)}_handleConnected(n,t={emit:!0}){var e;if(this._account=n,t.emit&&this.isConnectionStatusChanged("connected")){this.connectionStatus="connected";let t=null!==(e=null==n?void 0:n.address)&&void 0!==e?e:null;this.emit("connect",t),this.emit("accountChanged",t)}}_handleDisconnected(n={emit:!0}){this._account=null,n.emit&&this.isConnectionStatusChanged("disconnected")&&(this.connectionStatus="disconnected",this.emit("disconnect"),this.emit("accountChanged",null))}isAccountsChanged(n){var t;return(null==n?void 0:n.address)!==(null===(t=this._account)||void 0===t?void 0:t.address)}_handleAccountChange(n){if(this.isAccountsChanged(n)&&this.emit("accountChanged",(null==n?void 0:n.address)||null),!n){this._handleDisconnected();return}this._handleConnected(n,{emit:!1})}isNetworkChanged(n){return void 0===this._network||n!==this._network}_handleNetworkChange(n){this.isNetworkChanged(n)&&this.emit("networkChange",n||null),this._network=n}connect(){return u(this,void 0,void 0,function*(){if(this._account)return Promise.resolve(this._account);let n=yield this._callBridge({method:"connect",params:void 0});if(!n)throw a.b$.provider.unauthorized();return this._handleConnected(n,{emit:!0}),n})}isConnected(){return null!==this._account}account(){return u(this,void 0,void 0,function*(){let n=yield this._callBridge({method:"account",params:void 0});if(!n)throw a.b$.provider.unauthorized();return Promise.resolve(n)})}signAndSubmitTransaction(n){return u(this,void 0,void 0,function*(){let t=yield this._callBridge({method:"signAndSubmitTransaction",params:n});if(!t)throw a.b$.provider.unauthorized();return JSON.parse(t)})}signTransaction(n){return u(this,void 0,void 0,function*(){let t=yield this._callBridge({method:"signTransaction",params:n});if(!t)throw a.b$.provider.unauthorized();return new Uint8Array(c.from(t,"hex"))})}signMessage(n){return this._callBridge({method:"signMessage",params:n})}network(){return this._callBridge({method:"network",params:void 0})}getNetworkURL(){return this._callBridge({method:"getNetworkURL",params:void 0})}disconnect(){return u(this,void 0,void 0,function*(){yield this._callBridge({method:"disconnect",params:void 0}),this._handleDisconnected()})}onNetworkChange(n){return super.on(d.networkChange,n)}onAccountChange(n){return super.on(d.accountChanged,n)}on(n,t){return super.on(n,t)}emit(n,...t){return super.emit(n,...t)}}var g=e(48764).Buffer,v=function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function s(n){try{c(i.next(n))}catch(n){o(n)}}function a(n){try{c(i.throw(n))}catch(n){o(n)}}function c(n){var t;n.done?r(n.value):((t=n.value)instanceof e?t:new e(function(n){n(t)})).then(s,a)}c((i=i.apply(n,t||[])).next())})};class p extends h{constructor(n){super(Object.assign(Object.assign({},n),{bridge:n.bridge||(0,i.R)({timeout:n.timeout})})),this.isMartian=!0,window.dispatchEvent(new Event("martian#initialized"))}get publicKey(){var n,t;return null!==(t=null===(n=this._account)||void 0===n?void 0:n.publicKey)&&void 0!==t?t:null}_callMartianBridge(n){return n.aptosProviderType=this.aptosProviderType,this.bridgeRequest(n)}signAndSubmitTransaction(n){return v(this,void 0,void 0,function*(){if("string"==typeof n)return yield this._callMartianBridge({method:"martianSignAndSubmitTransaction",params:n});{let t=yield this._callMartianBridge({method:"signAndSubmitTransaction",params:n});if(!t)throw a.b$.provider.unauthorized();return JSON.parse(t)}})}signTransaction(n){return v(this,void 0,void 0,function*(){if("string"==typeof n)return this._callMartianBridge({method:"martianSignTransaction",params:n});{let t=yield this._callMartianBridge({method:"signTransaction",params:n});if(!t)throw a.b$.provider.unauthorized();return new Uint8Array(g.from(t,"hex"))}})}signGenericTransaction(n){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"signGenericTransaction",params:{func:n.func,args:n.args,type_args:n.type_args}})})}generateSignAndSubmitTransaction(n,t,e){return v(this,void 0,void 0,function*(){let i=yield this.generateTransaction(n,t,e),r=yield this.signAndSubmitTransaction(i);return r})}createCollection(n,t,e){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"createCollection",params:{name:n,description:t,uri:e}})})}createToken(n,t,e,i,r,o,s,a,c,u,d,l){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"createToken",params:{collectionName:n,name:t,description:e,supply:i,uri:r,max:o,royalty_payee_address:s,royalty_points_denominator:a,royalty_points_numerator:c,property_keys:u,property_values:d,property_types:l}})})}generateTransaction(n,t,e){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"generateTransaction",params:{sender:n,payload:t,options:e}})})}_convertStringToUint8Array(n){return new Uint8Array(n.split(",").map(n=>parseInt(n,10)))}_convertMaybeHexStringTostring(n){return"string"==typeof n?n:n.toString()}_convertAnyNumberToString(n){return"string"==typeof n?n:n.toString()}submitTransaction(n){return v(this,void 0,void 0,function*(){let t="string"==typeof n?this._convertStringToUint8Array(n):n;return this._callMartianBridge({method:"submitTransaction",params:g.from(t).toString("hex")})})}getTransactions(n){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"getTransactions",params:Object.assign(Object.assign({},n),{start:(null==n?void 0:n.start)?this._convertAnyNumberToString(n.start):void 0})})})}getTransaction(n){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"getTransaction",params:n})})}getAccountTransactions(n,t){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"getAccountTransactions",params:{accountAddress:this._convertMaybeHexStringTostring(n),query:Object.assign(Object.assign({},t),{start:(null==t?void 0:t.start)?this._convertAnyNumberToString(t.start):void 0})}})})}getAccountResources(n,t){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"getAccountResources",params:{accountAddress:this._convertMaybeHexStringTostring(n),query:Object.assign(Object.assign({},t),{ledgerVersion:(null==t?void 0:t.ledgerVersion)?this._convertAnyNumberToString(t.ledgerVersion):void 0})}})})}getAccount(n){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"getAccount",params:this._convertMaybeHexStringTostring(n)})})}getChainId(){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"getChainId",params:void 0})})}getLedgerInfo(){return v(this,void 0,void 0,function*(){return this._callMartianBridge({method:"getLedgerInfo",params:void 0})})}}}}]);
//# sourceMappingURL=5591.c9f52439b71c8c8a.js.map